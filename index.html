<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ToDo — minimal (hst.sh‑style)</title>
  <meta name="description" content="Ultra‑minimal one‑pane editor with checkboxes + local save" />
  <style>
    :root {
      --bg: #2e3440;
      --fg: #ffffff;
      --fg-dim: #cbd5e1;
      --muted: #8aa0b6;
      --accent: #94a3b8;
      --border: #1f2937;
      --ok: #86efac;
    }
    html, body {
      margin: 0; height: 100%; background: var(--bg); color: var(--fg);
      font: 16px/1.5 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }
    .wrap { position: fixed; inset: 0; display: grid; grid-template-rows: auto 1fr; }
    .topbar { display: flex; align-items: center; justify-content: flex-end; gap: 8px;
      padding: 10px 12px; border-bottom: 1px solid var(--border); background: rgba(255,255,255,0.02);
      user-select: none; }
    .btn { border: 1px solid var(--border); background: transparent; color: var(--fg);
      padding: 6px 10px; border-radius: 8px; cursor: pointer; font: inherit; opacity: .9; }
    .btn:hover { opacity: 1; border-color: #2b3a4d; }
    .flash { position: absolute; right: 12px; top: 10px; font-size: 12px; color: var(--ok);
      opacity: 0; transition: opacity .3s ease; }
    .flash.show { opacity: 1; }
    #editor {
      padding: 18px 20px 48px; outline: none; white-space: pre-wrap; word-break: break-word; caret-color: var(--fg);
      overflow: auto; }
    #editor:empty:before {
      content: "Type your todo list…  Press Ctrl+Shift+C to insert a checkbox.  Use Ctrl+S to save.";
      color: var(--muted);
    }
    .item { display: flex; align-items: flex-start; gap: .6rem; padding: 2px 0; }
    .item input[type="checkbox"] { appearance: none; width: 1rem; height: 1rem; border: 1px solid var(--accent);
      border-radius: 4px; display: inline-block; position: relative; margin-top: .2rem; cursor: pointer; }
    .item input[type="checkbox"]:checked { background: var(--accent); }
    .item input[type="checkbox"]:checked::after { content: ""; position: absolute; left: 3px; top: 1px; width: 6px; height: 10px; border: 2px solid var(--bg);
      border-top: 0; border-left: 0; transform: rotate(45deg); }
    .item .text { flex: 1; outline: none; }
    .item.done .text { text-decoration: line-through; color: var(--fg-dim); }
    .line { padding: 2px 0; }
    a { color: var(--fg); opacity: .85; text-decoration: none; border-bottom: 1px dotted var(--accent); }
    a:hover { opacity: 1; }
    .footer { position: fixed; left: 12px; bottom: 10px; color: var(--muted); font-size: 12px; user-select: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <button class="btn" id="newBtn" title="Clear note (Ctrl+N)">New</button>
      <button class="btn" id="saveBtn" title="Save (Ctrl+S)">Save</button>
      <span class="flash" id="flash">Saved ✓</span>
    </div>
    <div id="editor" contenteditable="true" spellcheck="false"></div>
  </div>
  <div class="footer">Local only • autosaves • no tracking</div>
  <script>
    const STORAGE_KEY = 'hstsh_todo_v1';
    const editor = document.getElementById('editor');
    const saveBtn = document.getElementById('saveBtn');
    const newBtn  = document.getElementById('newBtn');
    const flash   = document.getElementById('flash');
    function save() {
      localStorage.setItem(STORAGE_KEY, editor.innerHTML);
      flash.classList.add('show');
      setTimeout(() => flash.classList.remove('show'), 800);
    }
    function load() {
      const html = localStorage.getItem(STORAGE_KEY);
      if (html) {
        editor.innerHTML = html;
        ensureEventBindings();
      }
    }
    function clearAll() {
      if (editor.textContent.trim() === '' || confirm('Clear this note?')) {
        editor.innerHTML = '';
        save();
        placeCaretAtEnd(editor);
      }
    }
    function placeCaretAtEnd(el) {
      el.focus();
      const range = document.createRange();
      range.selectNodeContents(el);
      range.collapse(false);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
    }
    function wrapSelectionInTodo() {
      const html = '<div class="item"><input type="checkbox"><div class="text" contenteditable="true">New task</div></div>';
      document.execCommand('insertHTML', false, html);
      ensureEventBindings();
    }
    function ensureEventBindings() {
      editor.querySelectorAll('.item input[type="checkbox"]').forEach(cb => {
        if (!cb._bound) {
          cb.addEventListener('change', () => {
            const item = cb.closest('.item');
            item.classList.toggle('done', cb.checked);
            save();
          });
          cb._bound = true;
        }
      });
      editor.querySelectorAll('.item .text').forEach(span => {
        if (!span._bound) {
          span.addEventListener('input', autosave);
          span._bound = true;
        }
      });
    }
    function maybeConvertMarkdownLine() {
      const sel = window.getSelection();
      if (!sel.rangeCount) return;
      const range = sel.getRangeAt(0);
      const node = range.startContainer;
      let block = node.nodeType === 3 ? node.parentElement : node;
      while (block && block !== editor && !/^DIV|P|PRE$/.test(block.tagName)) block = block.parentElement;
      if (!block || block === editor) return;
      const text = block.textContent;
      const m = text.match(/^\s*- \[( |x|X)\]\s*(.*)$/);
      if (m) {
        const checked = m[1].toLowerCase() === 'x';
        const body = m[2];
        const tmpl = document.createElement('div');
        tmpl.innerHTML = `<div class="item ${checked ? 'done' : ''}"><input type="checkbox" ${checked ? 'checked' : ''}><div class="text" contenteditable="true"></div></div>`;
        tmpl.querySelector('.text').textContent = body;
        block.replaceWith(tmpl.firstElementChild);
        ensureEventBindings();
        save();
      }
    }
    let saveTimer = null;
    function autosave() {
      if (saveTimer) cancelAnimationFrame(saveTimer);
      saveTimer = requestAnimationFrame(save);
    }
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
        e.preventDefault();
        save();
        return;
      }
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'n') {
        e.preventDefault();
        clearAll();
        return;
      }
      if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key.toLowerCase() === 'c') {
        e.preventDefault();
        wrapSelectionInTodo();
        return;
      }
      if (e.key === 'Enter') {
        const sel = window.getSelection();
        if (!sel || !sel.rangeCount) return;
        let node = sel.anchorNode;
        node = node && node.nodeType === 3 ? node.parentElement : node;
        const textDiv = node && node.closest ? node.closest('.item .text') : null;
        if (textDiv && !e.shiftKey) {
          e.preventDefault();
          const range = sel.getRangeAt(0);
          const leftText = textDiv.textContent.slice(0, range.startOffset);
          const rightText = textDiv.textContent.slice(range.startOffset);
          textDiv.textContent = leftText;
          const newLine = document.createElement('div');
          newLine.className = 'line';
          newLine.setAttribute('contenteditable', 'true');
          newLine.textContent = rightText.trimStart();
          const curItem = textDiv.closest('.item');
          curItem.after(newLine);
          ensureEventBindings();
          const r = document.createRange();
          r.setStart(newLine.firstChild || newLine, 0);
          r.collapse(true);
          const s = window.getSelection();
          s.removeAllRanges();
          s.addRange(r);
          autosave();
        }
      }
    });
    editor.addEventListener('input', (e) => {
      autosave();
      if (e.inputType === 'insertText' && /[\]\sxX-]/.test(e.data || '')) {
        maybeConvertMarkdownLine();
      }
    });
    saveBtn.addEventListener('click', save);
    newBtn.addEventListener('click', clearAll);
    load();
    placeCaretAtEnd(editor);
    window.addEventListener('beforeunload', save);
  </script>
</body>
</html>
